<html>
<head>
<title>ASCER</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0"/>
<link rel="stylesheet" href="css/styles.css"/>
    
<script type="text/javascript">
    var $ = document; // shortcut
    var head  = $.getElementsByTagName('head')[0];
    var link  = $.createElement('link');
    link.rel  = 'stylesheet';
    link.type = 'text/css';
    
    if(navigator.userAgent.match(/iPhone/i)){
    	//alert('ENTRA IPHONE')
        link.href = 'css/ascer_iphone.css';
    }else if(navigator.userAgent.match(/iPad/i)) {
        link.href = 'css/ascer.css';
    }else{
        link.href = 'css/ascer_iphone.css';        
    }
   
    link.media = 'screen, projection';
    head.appendChild(link);
    

	
</script>


<script type="text/javascript" src="js/slider/jquery.js"></script>
<script type="text/javascript" src="libs/underscore-min.js"></script>
<script type="text/javascript" src="iphone-cordova-2.7.0.js"></script>

<!--<script type="text/javascript" src="js/cersaie.js"></script>-->
   <script type="text/javascript" src="js/ascer.js"></script>
<script type="text/javascript">
    
    var shortName = 'ascer'; 
            var version = '1.0'; 
            var displayName = 'ASCER Database'; 
            var maxSize = 2000000; // in bytes 
			var tempcompanies=[];
			
        var supportsOrientationChange = "onorientationchange" in window,
        orientationEvent = supportsOrientationChange ? "orientationchange" : "resize";
        
        window.addEventListener(orientationEvent, function() {
                                var alphabetic= $('#leftAlphabetic');	
                                var height = $(alphabetic).height();
                                $('.slider-content').css('height',height);
                                }, false); 
								
								 document.addEventListener("deviceready", onDeviceReady, false);
								 
								function onDeviceReady()
								{
										
										
            mydb = openDatabase(shortName, version, displayName, maxSize);
            
            
				window.setTimeout(function(){
					 mydb.transaction(
                                 function(transaction) {
                                 
                                 var sql = "CREATE TABLE IF NOT EXISTS companies(company_id integer PRIMARY KEY, full_name VARCHAR,short_name VARCHAR,initial VARCHAR,address_spain VARCHAR,code_spain VARCHAR,city_spain VARCHAR,state_spain VARCHAR,country_spain VARCHAR,telephone_spain VARCHAR,email_spain VARCHAR,fax_spain VARCHAR,website VARCHAR,hall VARCHAR,stand VARCHAR,coord_x VARCHAR,coord_y VARCHAR,mr_ms VARCHAR,manager VARCHAR,company_italy VARCHAR,person_italy VARCHAR,products VARCHAR,novelties VARCHAR,collection_photo_1 VARCHAR,format_photo_1 VARCHAR,serie_photo_1 VARCHAR,colors_photo_1 VARCHAR,id_photo_1 VARCHAR,collection_photo_2 VARCHAR,format_photo_2 VARCHAR,serie_photo_2 VARCHAR,colors_photo_2 VARCHAR,id_photo_2 VARCHAR,collection_photo_3 VARCHAR,format_photo_3 VARCHAR,serie_photo_3 VARCHAR,colors_photo_3 VARCHAR,id_photo_3 VARCHAR,logo_id VARCHAR,address_italy VARCHAR,city_italy VARCHAR,state_italy VARCHAR,country_italy VARCHAR,telephone_italy VARCHAR,email_italy VARCHAR,postal_code_italy VARCHAR,company_type VARCHAR,latitude VARCHAR,longitude VARCHAR,favorited NUMERIC) ";  
                                 
                                 transaction.executeSql(sql);
                                 },errorCB, successCB1);
								 
					},1000)
					
								}
								
								function errorCB(err) {
    alert("Error processing SQL: "+err.code);
}

function successCB1() {
   console.log("DB creation success!");
	//initDB();
	
	if(localStorage.insertedData==undefined || localStorage.insertedData==null || localStorage.insertedData==""){
					
					
					localStorage.setItem("insertedData",1);
					
					
										
													 
				
							 $.getJSON("companies.json",function(data){
          
								  // alert(data.length);
								  for (var i=0; i<data.length; i++) {
								  var row = data[i];
								  tempcompanies[i]= row;
								  
								  }			
											// alert(tempcompanies[i].company_id);
											insQuery="INSERT INTO companies (company_id, full_name,short_name,initial,address_spain,code_spain,city_spain,state_spain,country_spain,telephone_spain,email_spain,fax_spain,website,hall,stand,coord_x,coord_y,mr_ms,manager,company_italy,person_italy,products,novelties,collection_photo_1,format_photo_1,serie_photo_1,colors_photo_1,id_photo_1,collection_photo_2,format_photo_2,serie_photo_2,colors_photo_2,id_photo_2,collection_photo_3,format_photo_3,serie_photo_3,colors_photo_3,id_photo_3,logo_id,address_italy,city_italy,state_italy,country_italy,telephone_italy,email_italy,postal_code_italy,company_type,latitude,longitude,favorited) VALUES (";
											var result="";
						mydb = openDatabase(shortName, version, displayName, maxSize);					 
						mydb.transaction(
							function(transaction) {
														 	  
								for (var i=0; i<tempcompanies.length; i++) {
												 result=tempcompanies[i].company_id+",'"+tempcompanies[i].full_name+"', '"+tempcompanies[i].short_name+"', '"+tempcompanies[i].initial+"', '"+tempcompanies[i].address_spain+"', '"+tempcompanies[i].code_spain+"', '"+tempcompanies[i].city_spain+"', '"+tempcompanies[i].state_spain+"', '"+tempcompanies[i].country_spain+"', '"+tempcompanies[i].telephone_spain+"', '"+tempcompanies[i].email_spain+"', '"+tempcompanies[i].fax_spain+"', '"+tempcompanies[i].website+"', "+tempcompanies[i].hall+", '"+tempcompanies[i].stand+"', "+tempcompanies[i].coord_x+", "+tempcompanies[i].coord_y+", '"+tempcompanies[i].mr_ms+"', '"+tempcompanies[i].manager+"', '"+tempcompanies[i].company_italy+"', '"+tempcompanies[i].person_italy+"','"+tempcompanies[i].products+"', '"+tempcompanies[i].novelties+"', '"+tempcompanies[i].collection_photo_1+"', '"+tempcompanies[i].format_photo_1+"', '"+tempcompanies[i].serie_photo_1+"', '"+tempcompanies[i].colors_photo_1+"', '"+tempcompanies[i].id_photo_1+"', '"+tempcompanies[i].collection_photo_2+"', '"+tempcompanies[i].format_photo_2+"', '"+tempcompanies[i].serie_photo_2+"', '"+tempcompanies[i].colors_photo_2+"', '"+tempcompanies[i].id_photo_2+"', '"+tempcompanies[i].collection_photo_3+"', '"+tempcompanies[i].format_photo_3+"', '"+tempcompanies[i].serie_photo_3+"', '"+tempcompanies[i].colors_photo_3+"', '"+tempcompanies[i].id_photo_3+"', '"+tempcompanies[i].logo_id+"', '"+tempcompanies[i].address_italy+"', '"+tempcompanies[i].city_italy+"', '"+tempcompanies[i].state_italy+"', '"+tempcompanies[i].country_italy+"', '"+tempcompanies[i].telephone_italy+"', '"+tempcompanies[i].email_italy+"', '"+tempcompanies[i].postal_code_italy+"', "+tempcompanies[i].company_type+", "+tempcompanies[i].latitude+", "+tempcompanies[i].longitude+", "+tempcompanies[i].favorited;
											 
											
											sqlQuery=insQuery+result+")";
																// console.log(sqlQuery);
																													
											transaction.executeSql(sqlQuery);
											
											}//end of for loop
										}, errorHandler,succesInsert);//mydb
													
														
									
												 
						});//End of getjson				
					
					}else{
					initDB();
					}
}
	
	
	function succesInsert(){
	
	console.log("insert success");
	initDB();
	}
    
    
    $(document).ready(function() {
                      $('img').retina();
                      });

</script>
    
<style>
	/* The following styles are used only for this page - the actual plugin styles are in slidernav.css */
	* { margin: 0; padding: 0; }
	a { text-decoration: none; }
	h2, h3 { margin: 0 0 20px; text-shadow: 2px 2px #fff; }
	h2 { font-size: 28px; }
	h3 { font-size: 22px; }
	pre { background: #fff; width: 460px; padding: 10px 20px; border-left: 5px solid #ccc; margin: 0 0 20px; }
	p { width: 500px; font-size: 18px; line-height: 24px; margin: 0 0 30px; }
</style>
</head>
<body onLoad=" touchScroll('scroll')">
    <div id="content">       
        
        <div id="mainMenu">
            <a id="buttonList" class="buttonMenu-hover">
                <div id="imgList-hover" class="imageButton"></div>
                <div class="textButton">List</div>
            </a>
            <a id="buttonMap" href="map.html" class="buttonMenu">
                <div id="imgMap" class="imageButton"></div>
                <div class="textButton textColor">Map</div>
            </a>
            <a id="buttonFavorites" href="favourite_list.html" class="buttonMenu">
                <div id="imgFavorites" class="imageButton"></div>
                <div class="textButton textColor">Favorites</div>
            </a>
            <a id="buttonAbout" href="about.html" class="buttonMenu">
                <div id="imgAbout" class="imageButton"></div>
                <div class="textButton textColor">About</div>
            </a>  
            <div id="ascerLogo"></div>
        </div>
        
        <div id="secondaryMenu">
            <div id="subitem1" class="subitem-hover">
                <div class="textSubmenu submenu-font"><a href="#" onClick="changeFilter('subitem1');">All</a></div>
            </div>
            <div id="subitem2">
                <div class="textSubmenu submenu-font"><a href="#" onClick="changeFilter('subitem2')">Ceramic tiles</a></div>
            </div>
            <div id="subitem3">
                <div class="textSubmenu submenu-font"><a href="#" onClick="changeFilter('subitem3')">Sanitaryware</a></div>
            </div>
            <div id="subitem4">
                <div class="textSubmenu submenu-font"><a href="#" onClick="changeFilter('subitem4')">Others</a></div>
            </div>

            
            <div id="searchContainer"> 
                <div id="searchIcon"></div>
                <input id="searchInput"  type="search" class="search-key" placeholder="Search" onKeyUp="search()" />
 
            </div>
        </div>
        
        <div id="leftAlphabetic" class="non-scroll">
            
        </div>
        
        <div id="companyList" class="striped"> 
             <div id="slider">
                    <div id="scroll" class="slider-content">
                        <ul>
                            <!-- AQUI  VAN LAS EMPRESAS -->
                        </ul>
                    </div>
            </div>
        </div>
        
   </div>

</body>
</html>